@inject NavigationManager NavigationManager
@inject ApplicationAuthenticationStateProvider AuthenticationStateProvider

<nav class="mb-1 navbar navbar-expand-lg navbar-dark fixed-top shadow bg-primary">
    <a class="navbar-brand" href="#">DentalScheduler.Web.UI</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent-555"
    aria-controls="navbarSupportedContent-555" aria-expanded="false" aria-label="Toggle navigation" @onclick="ToggleNavMenu">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="@NavMenuCssClass navbar-collapse" id="navbarSupportedContent-555">
        <ul class="navbar-nav mr-auto">
            <AuthorizeView>
                <Authorized>
                    <li class="nav-item @(ActivePage == "home" ? "active" : "")">
                        <NavLink class="nav-link" href="" Match="NavLinkMatch.All" @onclick="@(() => ActivePage = "home")">
                            <span class="oi oi-home" aria-hidden="true"></span> Home
                        </NavLink>
                    </li>
                    <li class="nav-item @(ActivePage == "schedule" ? "active" : "")">
                        <NavLink class="nav-link" href="schedule" @onclick="@(() => ActivePage = "schedule")">
                            <span class="oi oi-list-rich" aria-hidden="true"></span> Schedule
                        </NavLink>
                    </li>
                </Authorized>
            </AuthorizeView>
            <li class="nav-item @(ActivePage == "about" ? "active " : "")">
                <a href="http://blazor.net" target="_blank" class="nav-link"><span class="oi oi-list-rich" aria-hidden="true"></span> About</a>
            </li>
        </ul>
        <AuthorizeView>
            <NotAuthorized>
                <ul class="navbar-nav ml-auto nav-flex-icons">
                    <li class="nav-item">
                        <NavLink class="nav-link" href="auth/login">
                            <span class="oi oi-list-rich" aria-hidden="true"></span> Login
                        </NavLink>
                    </li>
                </ul>
            </NotAuthorized>
            <Authorized>
                <ul class="navbar-nav ml-auto nav-flex-icons">
                    <li class="nav-item avatar dropdown @AvatarCssClass">
                        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-55" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false" @onclick="ToggleAvatarMenu">
                            <img src="https://mdbootstrap.com/img/Photos/Avatars/avatar-2.jpg" width="35" height="35" class="rounded-circle z-depth-0"
                            alt="avatar image">
                        </a>
                        <div class="dropdown-menu dropdown-menu-lg-right dropdown-secondary bg-primary @AvatarCssClass"
                            aria-labelledby="navbarDropdownMenuLink-55">
                            <NavLink class="nav-link dropdown-item bg-primary" href="/" @onclick="(() => Logout())">
                                <span class="oi oi-list-rich" aria-hidden="true"></span> Logout
                            </NavLink>
                        </div>
                    </li>
                </ul>
            </Authorized>
        </AuthorizeView>
    </div>
</nav>

@code {
    public string ActivePage { get; set; }

    private bool collapseNavMenu = true;

    private string NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    private bool showAvatarMenu = false;

    private string AvatarCssClass => showAvatarMenu ? "show" : null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private void ToggleAvatarMenu()
    {
        showAvatarMenu = !showAvatarMenu;
    }

    public async Task Logout()
    {
        await AuthenticationStateProvider.MarkUserAsLoggedOutAsync();

        NavigationManager.NavigateTo("", true);
    }
}
